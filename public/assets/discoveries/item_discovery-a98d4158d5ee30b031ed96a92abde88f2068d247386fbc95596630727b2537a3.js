$(".js-edit").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var t=$(this).parents(".js-container-text"),n=t.next();t.addClass("hide"),n.removeClass("hide")}),$(".js-submit").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();for(var c=$(this).parents(".js-container-form"),t=c.data("target-discovery-id"),d=c.find("textarea")[0].value,n=[],a=0;a<c.find(":checkbox:checked").length;a++)n.push(c.find(":checkbox:checked")[a].value);$.ajax({url:"/discoveries/"+t,type:"PATCH",dataType:"json",data:{authenticity_token:$("meta[name=csrf-token]").attr("content"),discovery:{content:d,genre_ids:n},id:t}}).done(function(e){var t=e.discovery.content,n=e.discovery.genre_ids,a=e.discovery.genre_names;c.addClass("hide"),d.value=t;for(var s=c.find(":checkbox"),r=0;r<s.length;r++){var i=parseInt(s[r].value);s[r].checked=n.includes(i)}var o="genres:";for(r=0;r<a.length;r++){o+=" "+("<span class='circle theme'>"+a[r]+"</span>")}$text=c.prev(),$text.removeClass("hide"),$text.find(".js-content-text")[0].innerText=d,$text.find(".js-genres-text")[0].innerHTML=o}).fail(function(e){var t=""==e.responseText?"\u901a\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002":e.responseText;alert(t)})});